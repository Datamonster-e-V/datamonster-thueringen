IF NOT EXISTS (SELECT name FROM sys.symmetric_keys WHERE name = '##MS_DatabaseMasterKey##')
    CREATE MASTER KEY ENCRYPTION BY PASSWORD = 'SuperStrongPasswordWith1Special#';
GO

IF NOT EXISTS (SELECT name FROM sys.certificates WHERE name = 'HADR_CERT')
    CREATE CERTIFICATE [HADR_CERT] 
    FROM BINARY = 0x308203F43082025CA003020102021057A5742657DCB0854E2D276EF656EB60300D06092A864886F70D01010B05003036313430320603550403132B436572746966696361746520666F72204461746162617365204D6972726F72696E6720456E64706F696E74301E170D3235303331323132323734305A170D3236303331323132323734305A3036313430320603550403132B436572746966696361746520666F72204461746162617365204D6972726F72696E6720456E64706F696E74308201A2300D06092A864886F70D01010105000382018F003082018A0282018100AAA4C424C9CD3944932C26606DB3A30394D9D0E28E23C6F854BA067C46D8924FE3A29260DDEC417CDF182C2AA2A129CA6B1C4643D5DF24FDF34A6C1EB4DEF95BEAD85556B3FD8915044257C14B3CEFEE2F39E6BA70916C9690B8CAEF9B1CB584EA1641BFDE49ED926371922DA8FE33083ADDC9A2DE44AF343570F0BE1F94FBC217E0CBF7DD4D5984F16AE76B3185AD09A0E6FDEFAC5A8F2C417DFA9D9BE5D85E1861E767E1A43E3EE82D3425803F3DD387A9EA3D93E466679A0AEB8B4267863028121669CF2F908BAF4444289C95AD1E53258875AEAE9CFC71065F1A95C11532BFD5CE48D758CD8E67ADBFB0A7C11AB7098E0787DD2A88D7546D76EFC3442AA61977367526531DE21D1FBDB43683BEC550A571355E3241D87C65456DD2F4DE5417DAB7ED045EB4F12D9CB74A1839F94EC391753467653428F02281066C4AE601999C9B195150DCEF058D7AE75ACE7DF33AA2EA3F296EBC9AC36D99296A431913A2EBE2BDF1A134CA179BBBEA09BD08DC0106F486CD3B95234F5981BBA8A02E390203010001300D06092A864886F70D01010B0500038201810088A164919DA0B714F9598ABB577E2B84C5C5C7AD0DFB56E7C6615676A21522EAFB53E3B044277372FCF563EA2BD0AB4E6699C3DC311F347A3DF82CF4168A2AC08E83EBCE038FB930FE0F65B0C03C2EAEF3BF12C24EDCC4E5DC04792F5B0836BD1578E4A794F548A69BF56DFB1995EFFF6EF78119D05A77AD5BE718B00535A75F28EDCE08F6E5D6A546EA84A291A7B7BBAC60D178E723789CD82DC6F57335E4C2EB04D5AD8C5DE3C856F6FF26A72145D9AA675543A2E06980864DF4B17D01787BC595ABED2491F8921CFAC598027CADF58F4DC5C9FF00E234A351853D94AD26EFB29186D3F7916784FC4A0BBCF3FA889C0E66985D84EB867AE10BEA0735FC6C128BABCBA76B049B14310B0F762EB3C3823BDFE06149A734C815E0A477A7E3F508036DC0787770F6EABF99DB186D5B2DA4A581683BC661F0B7204DA6E435D70093BA40EF84BF8ACBA9D60AD9D1CAE85FBAD9A7FB28E5988AE339CACAF9DDB11B192C5C4A8C9F7195371FA01FC648FBD6528B18E40419FEEE95EC136F39874D6B2F
    WITH PRIVATE KEY (BINARY = 0x1EF1B5B000000000010000000100000010000000D4060000D26947F00207E0A32A7AB749474DD9B70702000000A400006F7AE1503F56610795B54148E710AD8FA134A1266000BF2890CA9ADA9E67E61B443ADEF8654A2055B3861F594EB203A1E69EA56E868841D31873284BF2F6CD67B607BC5954F42DD12DD1F0CC0CFEA1DD300D88898CE82352752E6753C127C4A952DC44E696658928B903C01EE065CC54FB6A77762336481243260585AF876419934C91A0E438031047BFF92AC21E95061E33F79EEEF4702A250C52DF3C9388BFC3336082E9FE1ABA40C22E583973B6EDC4DF94355A4C8F331CA4D1B1C3FCE391E8250F859A1394AEA879E31C504E44DBA7DE560D4D4E3803B714DD0DC967C8B9F1B9C15E013E192A71467DAF69A9BA6F2569DC7BD7B7CC520ED50E70E71E4239CD66AEDB3892A107B166FB12FE94A81EB08028132E33D5B6ABD0A212161EE9B4F53A09766F693843271F2A441EF4166672B12BA15D7F2E6FFC862A6CB8E40996A46C7E9952345AA0DC8E67EB514997AABAA360E628C7ABD734BB10A37219D0CC72722232D282CE8E555CABFBB7257640F59F8DC429B8787D7F141B3B5BB9421B7982C24EEE2EE29F2CD938CBB5B0B590383616C885D357DD0B2DA1BB162B8F3E3DF4E33C0E7FDD630E21FE1C73EEDC41BD8B10E6B865A3AC7C59B2B95C2EE81504398F74B587B2A4747F4F32DBE0236BFF97D89AC78B30A0CCD9D2EC722CEA7A30BC08DEB056B60967D0441BA47DE7C8B32CDA1C8A52B7010EF9B703114E4FC585363F884B5DF5E8472F8A9184D27ED11D0CA235E6DC074CEC5CC152A6B8C7C457439978F4979FECC1E760EF0FB2CD036272187D19AA597A71D3F7DD7B053B01E7D7171C3001855D2E6E585AEF4B2F4DBC13A0FA430AD4EB568D63F1BD7C5E38A45F8F2B7031A2F85B45A6FAA64571E36E67994C4C37D59F70F97150077D055247E1D99EC9528731801FC45CB4E5C20D5C4B8337C80C3CDBBD4EB26C7C65242D6950435DC1E63AE537148795FF62430560FF6FD743BF0A2EBCB6B8BC386443404BDC28B705953EABCDC65461E8566D369543B1EC470F242DE92E11FF24FA3609B52D9141D0C8A0DBCFE76AA3B3AAB87199A350CA957F937FF6671DE532FA8BF592554DB563329BB28343140BDECCE7EF9D23246BF722761150F52C68066F44CAA7BCE0B1969A665AB223A6A1E9163683201E7CE019217387D159FDB02C486FA85438400DA60DF54FF7F834D047FDD84591864378E0286FF41D1379EF22AB946C1D6501D7F573CDC1DC1DCBBE02B22FB47D4FFB1B138059D2BD81F35D6EC38D0B85F12CB56DF5A4FFE768CF5E44CF1B3362C3C1435E405A356F88C4E45755E992C11823DCCA98479BD97ED4F943EA3CBFFFD3D527DAB93CDBBF6A1FB2C542579569D2DB0E683FD867EBADD0D1CFFA79D881A9B762F654248399FCA61F28E669D1F529BDD9B2E84BB7428AB7D19D26E5D6D43EFA59FCB7C94D28D22E21F5168F7D70F33F9C7BE676586C81B163BDA950582E95594A2DA365F17BD05DB1B4B08075A8728DB8C84E77AA054C39F8AA90F44132CF94902C2CF16E5C30B3EA5494C803E3020E17CF8ABC6AB37BFB687D9B516A053E9DF6E7C2B98B97FEB48D4AE7A035F5984ADE0162B73BF8D736E85F64D487F1E18EBAA303BB8208934E768EE5DE3FDCC43E22DC51F1EE24C51C4693CD45C05B8F800C203E102743204760BE8895528E7286872D201421854BBCC080E7B0337BFE611E3FFC0ABF0B49CDB05D5A48D985EA301AFFDEF4BEEA5890D8D1D9827538798F13EB97EB2581C3CB9B67A44D52B9B0FA54E49C198BC396F1A943C556EE9EAB79FC9023FAD9D966B4A325EA06B3701F08CDE207BDC71531012E2729CAE4DF34DE1511515B8513312A0F9F3A82D48CC48A25C935FE277B320F8F3A596EDBC4C656C32B3DA32A4D2BED2FF5FD36D78F43A786FBCE3161EA32042172794B48B5011CFB3AD391B61A6DB2ABE7149F7E22D23B4C22D760B79E85A124B6837DF31F5F8680E2743A956762E43C90F9522FFA818886A5287F7846D313C7682F2DE268F8653C61FF99DB699BEEEA19F29F3CF90D01B310E4058832C30944059345207DE3DA5F5AB4941A7252BEE648FDF494CAC6FC618A077D1CADC36FCB5181E3CE19A573CB7E3AFF70283F3AD790590E7748B778FE412F98A95E46F02860F6A99EB93835A39B51C8126CCBDB0A252926534CE2F90C0CBA97F5BE72312F7C685EF9370532135BD8523025861D7401A6F6BA5A1C0386BCD41DDE58D0FD018BB4DD1C924B5911115985CE0CFADBD46AEFA77FCA0DBE3804949E9B9F02BF3D5AA5FF75E0B6329D001B44020B97F03F1DAB8F3DEF5F22204787EA8DA13491BFD1107AD3502355E7ACEEC09232B0C7E3DEEB655D059C6705A03BDCF1F493CA7C0A30E35265F9DCF9174AF92E82C2A8257C3E3A439F983DD0EB173A6507A31D846369CB4AAD7EF09657BAD0E203F08C1B3AB6293B900798E66B086F51E7EA6B94
    ,DECRYPTION BY PASSWORD = 'StrongPassword!');
GO   

IF NOT EXISTS (SELECT name FROM sys.tcp_endpoints WHERE name = 'hadr_endpoint')
    CREATE ENDPOINT hadr_endpoint  
        STATE=STARTED   
        AS TCP (LISTENER_PORT=5022)   
        FOR DATABASE_MIRRORING (
            ROLE=ALL,
            AUTHENTICATION = CERTIFICATE HADR_CERT,
            ENCRYPTION = REQUIRED ALGORITHM AES
        );  

ALTER ENDPOINT [Hadr_endpoint]
    STATE = STARTED;
GO